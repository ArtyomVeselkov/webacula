#####################################################################################
>>>>>  Passos para Instalação do Webacula em Debian 8.4 <<<<<
#####################################################################################

Considerando que já possui o Bacula Instalado

>>> Atualizar a lista dos pacotes <<<
apt-get update


>>> Pacotes do PHP <<<
apt-get install php5 php5-gd php5-dev php5-mcrypt php5-curl


>>> Pacotes para o banco de dados MySQL <<<
*Quando solicitado a senha do mysql deixar em branco para ficar sem senha.
apt-get install mysql-server libmysqlclient-dev php5-mysqlnd


>>> Configurar o MySQL p/ ter acesso na rede <<<
Editar o arquivo /etc/mysql/my.cnf e alterar a linha bind-address: 
vim /etc/mysql/my.cnf
de: 	bind-address = 127.0.0.1
para:   bind-address = 0.0.0.0
/etc/init.d/mysql restart


>>> Configurar o timezone do PHP <<<
Editar o arquivo /etc/php5/apache2/php.ini e incluir  timezone e alterar o max_execution_time
vim /etc/php5/apache2/php.ini
date.timezone = America/Sao_Paulo
max_execution_time = 3600


>>> Clonar o repositório <<<
cd /usr/src/
git clone git@github.com:wanderleihuttel/webacula.git webacula


>>> Gerar a senha padrão <<<
cd /usr/src/webacula/install/
executar o comando: 
php password-to-hash.php PASSWORD  #onde o password será seu PASSWORD
A saída será algo como "$P$BN7e27dudrIi7LHaYs91bRAIZULVR60"


>>> Editar o arquivo /usr/src/webacula/install/db.conf <<<
E preencher com os dados de conexão do banco de dados (por padrão está tudo como bacula)
db_name="bacula"
db_user="bacula"
db_pwd="bacula"
Antes dos cifrões ($) do hash gerado anteriormente coloque barra invertida
webacula_root_pwd="\$P\$BN7e27dudrIi7LHaYs91bRAIZULVR60" 


>>> Criar as tabelas do Webacula <<<
Execute os 2 comandos abaixo para criar as tabelas do webacula
cd /usr/src/webacula/install/MySql
./10_make_tables.sh
./20_acl_make_tables.sh


>>> Alterar o arquivo /usr/src/webacula/application/config.ini <<<
E Editar as linhas do arquivo com os dados de sua conexão
db.adapter         = PDO_MYSQL
db.config.host     = localhost
db.config.username = bacula
db.config.password = bacula
db.config.dbname   = bacula
def.timezone = "America/Sao_Paulo"
bacula.sudo        = "/usr/bin/sudo"
bacula.bconsole    = "/sbin/bconsole"
bacula.bconsolecmd = "-n -c /etc/bacula/bconsole.conf"


>>> Dar permissão para o diretório webacula e para os arquivos bconsole e bconsole.conf <<<
Dar permissão para o diretório webacula e para os arquivos bconsole e bconsole.conf
cd /usr/src
chown -R www-data.www-data /usr/src/webacula
chown www-data /sbin/bconsole
chown www-data /etc/bacula/bconsole.conf
chmod 775 /etc/bacula
chmod 777 /usr/src/webacula/a/data/cache


>>> Configurar o apache para o funcionamento do webacula <<<
Copiar o arquivo /usr/src/webacula/install/apache/webacula.conf para  /etc/apache2/sites-available/webacula.conf
cp /usr/src/webacula/install/apache/webacula.conf   /etc/apache2/sites-available/webacula.conf


>>> Ativar o modo rewrite do apache <<<
a2enmod rewrite


>>> Habilitar o webacula.conf <<<
cd /etc/apache2/sites-available/
a2ensite webacula.conf
service apache2 restart


>>> Configurar permissão para o usuário www-data <<<
Executar o comando visudo ou editar o arquivo /etc/sudoers e adicionar a seguinte linha logo abaixo do usuário root.
vim /etc/sudoers
www-data ALL=NOPASSWD: /sbin/bconsole


>>> Copiar o diretório /root/webacula para o root do apache <<<
mv /usr/src/webacula  /var/www


>>> Criar grupo e usuário específio do bacula <<<
Verifique se existe o grupo e usuário bacula:
cat /etc/group | grep bacula
groupadd bacula
adicionar usuário www-data ao grupo bacula
usermod -aG bacula www-data

